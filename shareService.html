<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>e账柜-我的服务</title>
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="styles/base.min.css">
  <link rel="stylesheet" href="styles/service.min.css">
</head>
<body>

<div class="header themeBG">
  <a class="header-title" href="login_usePW.html" style="display: none">您尚未登录</a>
  <div class="header-mean forService" onclick="this.className=='header-mean forService'?this.className='header-mean forService open':this.className='header-mean forService'">
    <ul class="header-mean-list forService">
    
  <!-- <li class="item" >新年快乐有限公司</li> 
         <li class="item" >深圳亿账柜信息科技有限公司</li>
      <li class="item">东莞亿账柜信息科技有限公司</li>--> 
    
 	</ul>
    <span id="service-header-select">新年快乐有限公司</span>
    <i class="iconfont icon-xiajiantou"></i>
  </div>
</div>
<div class="service-adviser">
  <div class="service-adviser-left">
    <p id="adviser_info">专属顾问：<span>兰顾问</span></p>
  </div>
  <div class="service-adviser-right">
    <a href="tel:18520175581" id="adviser_tel"><i class="iconfont icon-dianhua"></i><span>18520175581</span></a>
  </div>
</div>
<div class="service-quota null">
  <p class="title"><span id="service_quota_month">1月财务指标</span><a class="link" id="show_detail" href="/service_list.html">详情 >></a></p>
  <p class="unit">单位：万元</p>
  <div class="service-quota-main clearfix">
    <a id="echart_main" href="/service_list.html">
    </a>
    <a class="info" id="financeAnalysis" href="/service_warn.html" >
      <p>
        本<br>
        月<br>
        财<br>
        税<br>
        预<br>
        警<br>
        >>
      </p>
    </a>
  </div>
  <div class="service-quota-null">
    <p>您尚未办理相关业务,<a href="/class/jzfw.html">马上了解,</a> 享受专业财税服务吧！</p>
  </div>
</div>
<div class="service-myService">
  <p class="title">我的服务</p>
  <div class="service-myService-null" style="display: block;">
    <p>您尚未办理相关服务,马上<a href="/">去商城逛逛</a>吧!</p>
  </div>
   <a href="service_my.html?companyid=8aad34155982dc66015982e59ccb0027&amp;productid=402880bc57a1d9810157a256cf63002d&amp;workOrderId=8aad341559b168e80159b175e327006c" class="service-myService-item"><p class="service-myService-item-name">地址变更</p> <p class="service-myService-item-state">目前进度：<strong>工商受理</strong></p> <div class="service-myService-item-deadline">预计完成时间：<span>2017-01-20</span></div>  <span>详情 &gt;&gt;</span></a><a href="service_my.html?companyid=8aad34155982dc66015982e59ccb0027&amp;productid=4028c18157954154015795615a100005&amp;workOrderId=8aad341559b1c2050159babdd7db0309" class="service-myService-item"><p class="service-myService-item-name">内资公司注册</p> <p class="service-myService-item-state">目前进度：<strong>工商约号</strong></p> <div class="service-myService-item-deadline">预计完成时间：<span>2017-01-20</span></div>  <span>详情 &gt;&gt;</span></a><a href="service_my.html?companyid=8aad34155982dc66015982e59ccb0027&amp;productid=402880bc57a33be30157a3e4df0100a5&amp;workOrderId=8aad341559b1c2050159babf4478030c" class="service-myService-item"><p class="service-myService-item-name">外观专利</p> <p class="service-myService-item-state">目前进度：<strong>递交申请</strong></p> <div class="service-myService-item-deadline">预计完成时间：<span>2017-01-20</span></div>  <span>详情 &gt;&gt;</span></a><a href="service_my.html?companyid=8aad34155982dc66015982e59ccb0027&amp;productid=8aad34155968187a01596ca16a9500d7&amp;workOrderId=8aad341559b1c2050159bac06511030f" class="service-myService-item"><p class="service-myService-item-name">高新技术产品认定</p> <p class="service-myService-item-state">目前进度：<strong>收集客户资料</strong></p> <div class="service-myService-item-deadline">预计完成时间：<span>2017-01-20</span></div>  <span>详情 &gt;&gt;</span></a><a href="service_my.html?companyid=8aad34155982dc66015982e59ccb0027&amp;productid=402880bc57a33be30157a35059530008&amp;workOrderId=8aad341559c5fb930159d4acd863014f" class="service-myService-item"><p class="service-myService-item-name">专项审计报告</p> <p class="service-myService-item-state">目前进度：<strong>审计实施</strong></p> <div class="service-myService-item-deadline">预计完成时间：<span>2017-01-25</span></div>  <span>详情 &gt;&gt;</span></a>
    
  
</div>
<div class="service-footer">
  <p class="title">- e账柜-中小企业财税服务共享服务中心 -</p>
  <div class="tel">
    <i class="iconfont icon-kefu"></i>
    <span class="number"><a href = "tel:4008812580">400-88-12580</a></span>
  </div>
</div>
<div class="dialog-main" id="telInput">
  <p class="title"><span>限时免费记账</span></p>
  <p class="clock"><span id="show">1天1时1分1秒</span></p>
  <label>
    <input class="input" id="userMobile" type="text" placeholder="请输入您的手机号">
  </label>
  <p class="info">请输入正确的手机号</p>
  <div class="buttonBox">
    <button type="button" class="button">立即体验</button>
  </div>
</div>
<!-- <footer class="footer">
 <a class="footer-cell" href="/">
    <span class="footer-cell-icon">
      <i class="iconfont icon-shouye"></i>
    </span>
    <p>首页</p>
  </a>
  <a class="footer-cell" href="/class/gszc.html">
    <span class="footer-cell-icon">
      <i class="iconfont icon-fenlei"></i>
    </span>
    <p>分类</p>
  </a>
  <a class="footer-cell" href="/service.html">
    <span class="footer-cell-icon">
      <i class="iconfont icon-fuwu"></i>
    </span>
    <p>服务</p>
  </a>
  <a class="footer-cell" href="/center.html">
    <span class="footer-cell-icon">
      <i class="iconfont icon-gerenzhongxin"></i>
    </span>
    <p>个人中心</p>
  </a>
</footer> -->
<footer class="footer">
 <a class="footer-cell" href="/">
    <span class="footer-cell-icon">
      <i class="iconfont icon-shouye"></i>
    </span>
    <p>首页</p>
  </a>
<!--   <a class="footer-cell" href="/class/gszc.html">
    <span class="footer-cell-icon">
      <i class="iconfont icon-fenlei"></i>
    </span>
    <p>分类</p>
  </a> -->
  <a class="footer-cell" href="/kfdialog.htm">
    <span class="footer-cell-icon">
      <i class="iconfont icon-zaixiankefuzhuanhuan"></i>
    </span>
    <p>在线咨询</p>
  </a>
  <a class="footer-cell" href="/service.html">
    <span class="footer-cell-icon">
      <i class="iconfont icon-fuwu"></i>
    </span>
    <p>我的服务</p>
  </a>
  <a class="footer-cell" href="/center.html">
    <span class="footer-cell-icon">
      <i class="iconfont icon-gerenzhongxin"></i>
    </span>
    <p>个人中心</p>
  </a>
</footer>

<div class="showTelInput" id="showTelInput" style="display: none">
   <p class="text">优惠</p>
  <p class="text">抢购</p>
</div> 
<script src="scripts/jquery.min.js"></script>
<script src="/scripts/common/common.js"></script>
<script src="/scripts/common/module.js"></script>
<script src="/scripts/show_dialog.min.js"></script>
<script src="/scripts/show_loading.min.js"></script>
<script src="/js/count.js"></script>
<script src="/scripts/echarts.simple.min.js"></script>
<script src="/scripts/count_down.min.js"></script>

<script type="text/javascript">

//	setCookie("serviceIsClick",true);
	var validTimestamp = 1000*60*60*60;
	$(function(){
		
		   var date = new Date();
		    var year = date.getFullYear();
		    var month = date.getMonth()+1;
		    var day = date.getDate();
		    companyid = getUrlParam("companyid");
		    if(day<23){
		      day=day+7
		    }else {
		      month=month+1
		      day=0
		    }

			var data = new Date();
			var mon =  data.getMonth()+1; //获取当前月份(0-11,0代表1月) 
			var day =  data.getDate(); //获取当前日(1-31)  
			if(day>21){
				 mon = mon -1;
				 
			}else{
				 mon = mon -2;
			}
			if(mon <= 0){
				 mon = 12 +mon;
			}
			var  str=mon+"月财务指标"
				  $("#service_quota_month").text(str);
			
		var requestKey = getUrlParam("requestKey");
		var accessToken =  getUrlParam("accessToken");
		var url = TERMINAL_URL + '/jsonrest/http/HttpServiceInfo/1/getWorkDetailByRequestKey';
		
		  $.post(url,{"requestKey":requestKey,"accessToken":accessToken,"validTimestamp":validTimestamp},function(re){//获取当前状态
			  
			  if(re.msgCode == 1){//表示成功
				 
				  if(re.entity.yongyou){//加载财税信息
					  $(".service-quota").removeClass("null");
					  var monthz = parseInt(re.entity.yongyou.month.substring(4,6));
					  $("#service_quota_month").html(monthz+"月"+"财务指标")
					  loadECharts(re.entity.yongyou);
				  }else{
					  $(".service-quota").addClass("null");

				  }
			  
			  	  if(re.entity.workOrder){
			  	
			  		  loadCompanyWorkOrder(re.entity.workOrder);
			  		
			  	  }
			  }else{
				  //失败，打印失败信息
				  var error_dialog2 = new Dialog('#error_dialogz', {
					  time: 1000000/*,
					  callbackAfter:function(){
						//  location.href = '/login_usePW.html';
						  error_dialog2.remove_dialog();
					  }*/
					});
					error_dialog2.setButton({"errorbutton2":'确定'});
					$("#errorbutton2").click(function(){
						location.href = '/login_usePW.html';
						error_dialog2.remove_dialog();
					});
				  
					 error_dialog2.setText(re.msg);
					  error_dialog2.show_dialog();
					  
			  }
			 
			  console.log(re);
			  
			  
		  },"json");
	});
	
	  function loadCompanyWorkOrder(companyWorkOrder){
		
	
			  $("#service-header-select").text(companyWorkOrder.companyName);

				  var company = companyWorkOrder;
				  var products = company.products;
				  var companyid = company.companyId;

				  var productid = "";
				  var workOrderId = "";
				  var adviser = company.adviser;
				  var adviserMobile = company.adviserMobile;
				  $("#adviser_info>span").html(adviser);
				  if (adviserMobile){
					  $("#adviser_tel").attr('href',"tel:"+adviserMobile);
					  $("#adviser_tel>span").html(adviserMobile);
				  }
					 
				  $(".service-myService-item").remove();
				  if(!products ||products.length==0){
					  $(".service-myService-null").show();
					  $(".service-myService-item").hide();
				  }else{
					  $(".service-myService-null").hide();
					  var html = '';
					  var _proName = "";
					  for(var i= 0, l=products.length; i<l; i++){
						  productid = products[i].productId;
						  workOrderId = products[i].workOrderId;
						  _proName = products[i].productName;
						  if (_proName.indexOf("（") != -1){
							  _proName = _proName.substring(0, _proName.indexOf("（"));
						  }else if (_proName.indexOf("(") != -1){
							  _proName = _proName.substring(0, _proName.indexOf("("));
						  }
						  html += 
						  '<a href="'+ products[i].detailUrl+'" class="service-myService-item">'
						   + '<p class="service-myService-item-name">'+_proName+'</p>'
						   + ' <p class="service-myService-item-state">目前进度：<strong>'+products[i].currentProcess+'</strong></p>'
						   + ' <div class="service-myService-item-deadline">预计完成时间：<span>'+products[i].preEndDate+'</span></div>'
						   + '  <span>详情 >></span>';
						   + ' </a>';
						   
					  }
					  $(".service-myService-null").after(html);
				  }
			  
		  
	  }
	  function loadECharts(companyProduct){
		  console.log("--begin--");
		  console.log(companyProduct);
		  console.log("--end--");
		  var myChart = echarts.init(document.getElementById('echart_main'));
		  var hbzj = (+companyProduct.hbzj/10000).toFixed(2);
		  var yysr = (+companyProduct.yysr/10000).toFixed(2);
	      var cbfy = (+companyProduct.cbfy/10000).toFixed(2);
	      var lr = (+companyProduct.lrze/10000).toFixed(2);
	      var sj = (+companyProduct.sj/10000).toFixed(2);
	      var hbzjMap = {"name":"货币资金","value":hbzj};
	      var yysrMap =  {"name":"营业收入","value":yysr};
	      var cbfyMap = {"name":"成本费用","value":cbfy};
	      var lrMap =  {"name":"利润","value":lr};
	      var sjMap =  {"name":"税金","value":sj};
	      var normal = {'barBorderColor': '#ff3333','color':'#ff3333'};
	      var itemStyle = {"normal":normal};
	      var companyId = companyProduct.companyid;
	      
	      if(hbzj<0){
	    	  hbzjMap.itemStyle = itemStyle;
	      }
	      
	      if(yysr<0){
	    	  yysrMap.itemStyle = itemStyle;
	      }
	      
	      if(cbfy<0){
	    	  cbfyMap.itemStyle = itemStyle;
	      }
	      
	      if(lr<0){
	 
	    	  lrMap.itemStyle = itemStyle;
	      }
	      
	      if(sj<0){
	    	  sjMap.itemStyle = itemStyle;
	      }
	      var data = [];
	      data.push(hbzjMap);
	      data.push(yysrMap);
	      data.push(cbfyMap);
	      data.push(lrMap);
	      data.push(sjMap);
		// 指定图表的配置项和数据
		    var option = {
		      tooltip: {},
		      xAxis: {
		        data: ["货币资金", "收入", "成本、费用", "利润", "税金"],
		        axisLabel: {
		            interval: 0
		          }
		      },
		      yAxis: {
		        axisLabel: {
		          show: false
		        },
		        axisTick: {
		          show: false
		        }
		      },
		      grid: {
		          top: 20,
		          right: 20,
		          left: 20,
		          bottom: 40
		        },
		      series: [{
		        name: '销量',
		        type: 'bar',
		        barCategoryGap:'50%',
		        label: {
		          normal: {
		            show: true,
		            position: 'top'
		          }
		        },
		        itemStyle: {
		          normal: {
		            barBorderColor: '#3f85bf',
		            color: '#3f85bf'
		          }
		        },
		     
		        data: data
		      }]
		    };
		    myChart.setOption(option)
		    
		     $("#show_detail").attr("href","/service_list.html?companyId="+companyId);
		     $("#financeAnalysis").attr("href","/service_warn.html?companyId="+companyId);
		 
		     $("#echart_main").attr("href","/service_list.html?companyId="+companyId);
					  

	  }
</script>
</body>
</html>
